#!/bin/sh

SOURCE_CODE_EXTENSIONS='(11|19|2clk|3dfbat|3rf|4ge|4gl|4pk|4th|82p|89x|8xk|92x|a2w|a2x|a3c|a3x|a51|a5r|a66|a86|a8s|a|aah|aar|a|aba|abap|abc|abl|abs|acgi|ac|acm|acr|act|action|actionscript|actproj|actx|acu|ad2|ada|ad|adb|adiumscripts|ads|adt|aem|aep|afb|agc|agi|agls|ago|ags|ahk|ahtml|aia|aidl|aifb|aiml|airi|ajm|akp|aks|akt|alan|alb|alg|alm|alx|amf|aml|amos|amw|an|androidproj|ane|anjuta|anm|apb|ap|apg|aplt|appcache|app|applescript|applet|appxmanifest|appxsym|appxupload|aps|apt|arb|armx|arnoldc|aro|arq|arscript|art|artproj|arxml|ary|as3|as|asax|asbx|asc|ascx|asf|ash|asi|asic|asm|asmx|aso|asp|asproj|aspx|asr|ass|asta|astx|asz|atl|atm|atmn|atmx|atomsvc|atp|ats|au3|aut|autoplay|autosave|avc|ave|avs|avsi|awd|awk|awl|axb|axd|axe|axs|b24|b2d|bal|bas|bash|bat|bax|baz|b|bb|bbc|bbf|bbproject|b|bcc|bcf|bcp|bdh|bdsproj|bdt|beam|beta|bet|bgm|bhs|bil|bi|bks|bli|bltx|bml|bmml|b|bmo|bms|boo|borland|box|bp|bpk|bpo|bpr|bps|bpt|brml|brs|brx|bs2|bsc|bsd|bsh|bsml|bsm|bsv|bte|btproj|btq|bufferedimage|builder|build|buildpath|bur|bxb|bxl|bxml|bxp|bzs|c3p|c86|cal|c|cap|capfile|car|cas|c|catscript|catvbs|c|cba|cb|cbl|cbp|cbq|cbs|cc|ccbjs|cc|c|ccp|ccproj|ccs|ccxml|cdproj|cd|cel|celx|cesf|cfi|cfm|cfml|cfo|cfs|cgi|cg|cgvp|cgx|ch|chd|chef|chh|ck|ckm|cla|classdiagram|class|classpath|cl|clips|clj|cljs|clm|clojure|clp|cls|clu|clw|clx|cma|cmake|cml|cmp|cms|cnt|cob|cobol|codasite|cod|coffee|cola|command|common|con|configure|confluence|con|cord|cos|coverage|coveragexml|cp|cpb|cp|cphd|cplist|cpp|cpr|cprr|cp|cpy|cpz|cr2|cr|creole|cryproject|csb|csc|cs|csc|csdproj|csf|csgrad|csh|cshrc|csi|csm|cs|csml|cson|csp|cspkg|csproj|cs|csview|csx|ctl|ctp|cu|cuh|cuo|cus|cva|cvsrc|cx|cxe|cxl|cxs|cxt|cxx|cya|d2j|d4|dadx|daemonscript|das|datasource|db2|db2tbl|db2tr|db2vw|dba|db|dbg|dbheader|dbmdl|dbml|dbo|dbp|dbpro|dbproj|dc|dcf|dcproj|dcr|ddb|d|dd|ddp|d|deb|defi|depend|deployproj|dep|derp|des|dev|devpak|dfb|dfd|dfm|dg|dgml|dgscript|dgsl|dht|dhtml|dia|dic|di|dif|diff|dil|dimg|din|dist|djconf|djconfig|djg|djscript|dlg|dmb|dmc|dml|dms|dob|docstates|do|dor|dot|dpd|dpj|dpk|dplt|dpq|dpr|dproj|dpr|dqy|drc|dro|dsa|dsb|ds|dsd|ds|dse|dsl|dso|dsp|dsq|dsr|dsym|dtd|dtml|dto|dt|dts|dtx|dvb|dwarf|dwav|dwp|dws|dwt|dxl|eaf|e|ebc|ebm|ebs2|ebs|ebuild|ebx|ecorediag|ecore|edml|e|eek|e|efss|egg|ejs|ekm|elc|eld|el|ema|emakefile|emakerfile|enml|entitlements|ephtml|epj|epl|epp|ept|eql|eqn|erb|erl|erubis|es6|es|ev3p|ew|exc|ex|exp|exprwdxsl|exsd|exu|exv|exw|eze|ezg|f03|f40|f77|f90|f95|faces|factorypath|fas|fasl|fbp6|fbp|fbz6|fcg|fcgi|fcmacro|fdm|fdml|fdo|fdt|ff|f|fgb|fgl|fil|flm|fmb|fmt|fmx|for|form|forth|fountain|fp|fpc|fpi|fpp|frj|frs|frt|fsb|fscr|fsf|fsi|fsl|fs|fsproj|fsscript|fsx|ftn|ftr|fuc|fus|fwactionb|fwaction|f|fwx|fxcproj|fxh|fxl|fxml|fzs|g1m|g1w|gadgeprj|galaxy|gas|gbap|gbl|gc3|gch|gcl|gcob|gcode|gdg|geany|gek|gemfile|generictest|genmodel|geojson|gfa|gfe|ghc|ghp|git|glade|gla|gld|glf|gls|gml|gnt|gnumakefile|gobj|goc|go|gp|gradle|graphml|graphmlz|greenfoot|groovy|grxml|gsb|gsc|gs|gsk|gss|gst|gsym|gus|gv|gvy|gxl|gyp|gypi|h2o|h5bprj|h6h|hal|haml|has|hay|hbm|hbs|hbx|hbz|h|hc|hcw|hdf|hdl|hei|hemcr|hevbs|hh|hhh|hic|hid|history|hkp|hla|hlsl|hms|hoic|hom|hpf|hpp|hrh|hrl|hsc|hsdl|hse|hs|hsm|ht4|htc|htd|htm|html5|htr|hxa|hx|hxml|hxp|hxproj|hxx|hydra|iadaction|iadclass|iadpage|iadproj|iadstyle|iap|i|ice|icl|ic|icn|idb|ide|idle|idl|ifos|ifp|ig|ihex|ii|ijs|ik|il|ilk|il|image|i|iml|imp|inc|ino|inp|ins|inspxeproj|install|io|ipb|ipch|ipf|ipp|ipproj|ipr|ips|ipy|irb|irbrc|irc|irev|irobo|isa|ism|is|iss|issuite|isu|isym|itcl|itmx|iwb|ix3|ixx|j3d|jacl|jade|jad|jak|jardesc|java|javajet|jav|jbi|jbp|jcl|jcm|jcs|jcw|jdp|jetinc|jex|jgc|jgs|ji|j|jks|jlc|jl|jmk|jml|jomproj|jpage|jpd|jpx|jsa|jsb|jsc|jscript|jsdtscope|js|jse|jsf|jsfl|jsh|js|jsl|jsm|json|jsonp|jsp|jss|jsx|jsxinc|jtb|judo|jug|ju|jxl|kb|kbs|kcl|kdevprj|kd|ked|kex|kit|kix|kl3|kmdi|kml|kmt|kodu|komodo|kon|kpl|ksc|ksh|ks|kst|kt3|kt|kts|kumac|kv|kx|l1i|lamp|lap|lasso|lay|lba|lbi|lbj|lds|ldz|less|lex|lgt|lhs|lib|licenses|licx|liquid|lisp|lis|litcoffee|lit|l|ll|lml|lmp|lmv|lng|lnk|lnp|lnx|loc|login|lo|lol|lols|lp|lpr|lpx|lrf|lrs|ls1|ls3proj|lsh|lsp|lss|lst|lsxtproj|luac|lua|lub|luca|lwa|lwmw|l|lxk|lxsproj|m2|m2r|m3|m4|m4x|m51|m6m|mab|mac|magik|makefile|make|maki|mak|mako|m|maml|map|mash|master|matlab|mat|mbam|mbas|mb|mbs|mbtemmplate|mc6|mca|mc|mcml|mc|mcp|mcr|mcw|mdex|mdf|md|mdp|mdsp|mec|mediawiki|mel|mem|mex|mfa|mf|mfl|mfps|mg|mhl|mhm|mingw32|mingw|mi|mix|mkb|mke|mk|mli|m|ml|mln|ml|mls|mlsxml|mlv|mlx|mly|mm|m|mmbas|mmb|mmch|mm|mmh|mmjs|mml|mm|mnd|m|moc|mod|module|mo|mom|mpd|mpkt|mpm|mpx|mq4|mq5|mqt|mrc|mrd|mrl|mrm|mrs|ms|msc|mscr|m|mscr|msct|msdev|msdl|msh1|msh1xml|msh2|msh2xml|msha|msil|msl|msm|ms|msp|mss|mst|msvc|msym|mtp|mtx|mvba|mvc|mvpl|mw|mwp|mxe|mx|myapp|mzp|napj|nas|nbin|nbk|ncb|ncx|ndpvs|neko|nes|netboot|netproject|nhs|njk|nj|nk|nlc|nlpj|nls|nmk|nmpj|nms|nnb|nokogiri|nopj|npi|npl|nppj|nqc|nrs|nsconfig|nse|nsi|nspj|nsx|nt|nunit|nunj|nunjs|nunjucks|nupkg|nvi|nxc|ob2|obj|obr|ocamlmakefile|ocb|ocr|odc|odh|odl|ods|ogl|ogr|ogs|ogx|okm|oks|o|ook|oplm|opl|oppo|opt|opv|opx|oqy|orc|orl|osas|osg|owd|ow|owl|owx|ox|p4a|p5|p6|pag|param|par|pas|pawn|pba|pbi|pbl|pbp|pb|pbq|pbx5script|pbxbtree|pbxproj|pbxscript|pcd|pch|pc|pcs|pdb|pde|pdl|pdml|pdo|pd|pds|pem|perlctrl|perlnet|perl|perlsvc|perltray|pf0|pf1|pf2|pf3|pf4|pfa|pfx|pgm|pgml|pgm|phl|php1|php2|php3|php4|php5|php6|ph|php|phpproj|phps|phpt|phs|phtml|pickle|pika|pike|pjt|pjx|pkb|pkh|pl1|pl5|pl6|pl7|plac|playground|plc|pli|plog|pl|pls|plx|pm5|pm6|pml|pmod|pm|pmp|pnproj|pnpt|poc|pod|poix|policy|pom|po|pou|pp1|ppa|ppam|p|pp|ppml|ppo|pp|p|pql|pr7|prg|pri|prl|prm|pro|propertiesjet|pro|proto|prx|ps1|ps2|ps2xml|psc1|psc2|psd1|psf|psgi|psl|psm1|psml|pspscript|psu|ptb|ptl|ptxml|ptx|pvs|pwn|pwo|pxd|pxi|pxl|pxml|pxt|py3|pyc|pym|pyo|py|pyproj|py|pyt|pyw|pyx|qac|qcf|qdl|qf|qlc|qlm|qml|qpf|qpr|qry|qsc|qs|qt3d|qvs|qxm|qx|radius|rakefile|rake|rapc|rbc|rbf|rb|rbp|rb|rbs|rbt|rbvcp|rbw|rbx|rc2|rc3|rcc|rc|rcs|rdf|rdoc|rdoff|reb|rej|re|resjson|res|resources|resx|rex|rexx|rfs|rfx|rgs|rguninst|rh|rhtml|ridl|rip|rkt|rml|rmn|rng|rnw|robo|rob|ror|rpg|rpj|rpo|rpprj|rpp|rpres|rprofile|rproj|rptproj|rpyc|rpym|rpy|rqb|rqc|rqy|rrc|rrh|r|rsl|rsm|rsp|rs|rssc|rss|rsym|rtk|rtml|rts|rub|rule|run|rvb|rvt|rws|rxs|s2s|s43|s4e|s5d|saas|sal|sami|sar|sasf|sas|sass|sas|sax|sbh|sbi|sb|sbml|sbproj|sbr|sbs|scala|scar|sca|scb|sc|sce|sc|sci|scm|sconstruct|scp|scpt|scptd|script|scriptsuite|scriptterminology|scro|scr|scs|scss|sc|sct|scx|scz|sda|sdef|s|sdi|sdl|sdsb|seam|seestyle|seman|ser|ses|sfl|sfm|sfp|sfr|sf|sfx|shfbproj|shfb|shit|sh|sid|simba|simple|sim|sit|sjava|sjc|sjs|skp|slackbuild|slim|sln|slogo|slogt|sl|sls|sltng|slt|sma|smali|smd|smi|sml|smm|sm|smw|smx|snapx|snippet|sno|snp|spk|spr|sps|spt|spx|sqldataprovider|sqljet|sqlproj|sqo|src|srz|ssc|sscs|ssc|ssi|ssml|s|ssq|ss|startlet|stl|st|stm|sts|stuffit11task|styl|sus|svc|svo|svx|sw|swg|swift|swt|sxs|sxt|sxv|sym|syp|tab|tag|tal|targets|tatxtt|tbasicc|tbasic|tbasicx|tcl|tcsh|tcx|tcz|tdo|tea|tec|tem|tes5pas|texinfo|text|textile|tgml|tgproj|thml|thor|thtml|tig|tik|tikz|tilemap|tiprogram|ti|tkp|tk|tla|tlc|tld|tlh|tli|tlv|tmf|tmh|tml|tmo|tmpl|tokend|toml|tom|tpl|tplt|tpm|tpr|tps|tpt|tpx|tql|tracwiki|transcriptstyle|tra|trig|trs|trt|tru|ts0|tsc|tsq|tst|t|ttcn|t|ttinclude|ttl|t|turboc3|tur|tu|twig|txc|txl|txml|txx|tzs|ucb|udf|uem|ufdl|uih|uit|uix|ulp|umlclass|ump|unx|urj|usi|usp|uvprjx|uvprojx|uvproj|v3s|v4e|v4s|vad|vala|vap|vba|vbe|vbg|vbhtml|vbi|vb|vbp|vbproj|vbscript|vbs|vbw|vbx|vc15|vc1|vc2|vc4|vc5|vc6|vc7|vce|vcp|vcproj|vc|vcwin32|vcxproj|vddproj|vdm|vdp|vdproj|vd|vdt|vfproj|vgc|vic|vim|vip|viw|vjp|vjsproj|vls|vlx|vmx|vpc|vpi|vpl|vps|vrm|vrp|vscontent|vsixmanifest|vsmacros|vspolicy|vsprops|vssscc|vss|vstemplate|vtm|vtml|vup|v|vxml|w32|wam|was|wax|wbc|wbf|wbs|wbt|wch|wcm|wdgtproj|wdi|wdk|wdl|wdproj|wdw|wdx9|wfs|wiki|win32manifest|win|wis|wixout|wix|wli|wmc|wmlc|wmlsc|wmls|wml|wmw|woa|wod|w|wowproj|wpj|wpk|wpm|wsc|wscript|wsc|wsdd|wsdl|wsd|wsf|wsh|wsil|ws|wspd|wsp|wsrmac|wsym|wxi|wxl|wxs|wx|wzs|xaml|xamlx|xap|xba|xbap|xbc|xbd|xblr|xbl|xbs|xcl|xcodeproj|xcp|xct|xda|xds|xfm|xhtm|xib|xig|xin|xjb|xje|xla|x|xlm3|xlm4|xlm|xlv|xl|xmap|xme|xmla|xmljet|xml|xmsc|xmss|xmta|xn|xnf|xoml|xpb|xpdl|xpgt|xproj|xql|xqr|xrc|xr|xsc|xscscpt|xsc|xsd|xslt|xsl|xsql|xtxt|xui|xul|xv2|xweb3master|xweb4asax|xweb4htt|xweb4js|xweb4stm|x|xys|yab|yajl|yaml|yml2|ywl|y|yxx|yyp|zasm|zbi|zcls|zcode|zero|zfd|zfrm|zfs|zms|zpd|zpk|zpl|zrx|zsc|zsh|zsrc|zs|zts|zws|z)'
FILENAME_REGEX=".*\.${SOURCE_CODE_EXTENSIONS}"

do_search() {
    local key=$1
    local path=$2
    case `uname` in
	FreeBSD)
	    find -E "${path}" \
		 -type f \
		 -regex "${FILENAME_REGEX}" \
		 -exec /usr/bin/grep -i -I --with-filename --line-number "${key}" '{}' ';'
	    ;;
	Linux)
	    find "${path}" \
		 -type f \
		 -regextype posix-extended \
		 -regex "${FILENAME_REGEX}" \
		 -exec /usr/bin/grep -i -I --with-filename --line-number "${key}" '{}' ';'
	    ;;
    esac
}


if [ "$1" = "-e" ]; then
   # Grep all files
   FILENAME_REGEX=".*"
   shift
fi

src_string="${1}"

if [ -z "${src_string}" ]; then
	echo "Usage: $0 [keyword] [[directory]]"
	exit 0
fi

if [ -z "${2}" ]; then
	dir="."
else
	dir="${2}"
fi

do_search "${src_string}" "${dir}"
